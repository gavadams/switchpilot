# SwitchPilot Comprehensive Testing Checklist
# Updated: Session 9 - Stripe Payment Integration

## üîê AUTHENTICATION & USER MANAGEMENT
### Login/Registration
- [ ] User can register with email/password
- [ ] User can login with valid credentials
- [ ] Login redirects to dashboard after successful authentication
- [ ] Invalid credentials show appropriate error messages
- [ ] Password requirements are enforced during registration
- [ ] Email validation works correctly
- [ ] User session persists across browser refreshes
- [ ] Logout functionality works and redirects to login page
- [ ] Protected routes redirect unauthenticated users to login

### User Profile
- [ ] User profile data loads correctly
- [ ] Profile information displays properly
- [ ] User can update profile information
- [ ] Stripe customer ID is created and stored correctly

## üè† DASHBOARD & NAVIGATION
### Dashboard Layout
- [ ] Dashboard loads with all cards visible
- [ ] Navigation sidebar works on desktop and mobile
- [ ] Mobile sidebar is not transparent
- [ ] All navigation links work correctly
- [ ] User can access all main sections (Dashboard, Deals, Switches, Billing, Settings)
- [ ] Breadcrumbs display correctly on all pages
- [ ] User avatar and name display in header

### Dashboard Cards
- [ ] Active Switches card shows correct count
- [ ] Available Deals card shows correct count
- [ ] Earnings card displays total earnings correctly
- [ ] Recent Activity card shows recent switches
- [ ] Quick Actions buttons work correctly
- [ ] "Setup Direct Debit" button links to billing page
- [ ] All text wraps properly and doesn't overflow cards
- [ ] Cards are responsive on mobile devices

## üè¶ BANK DEALS & SWITCHING
### Deals Page
- [ ] All bank deals load and display correctly
- [ ] Deal cards show bank name, reward amount, expiry date
- [ ] Required direct debits are displayed on deal cards
- [ ] Filtering by bank name works
- [ ] Sorting by reward amount works
- [ ] Sorting by expiry date works
- [ ] "Start Switch" button opens dialog correctly
- [ ] Deal cards are responsive on mobile
- [ ] Text doesn't overflow deal cards

### Switch Workflow
- [ ] Switch creation works from deal cards
- [ ] Switch steps display in correct order
- [ ] Step completion works correctly
- [ ] Notes can be added to each step
- [ ] Auto-save functionality works for notes
- [ ] Progress calculation is accurate
- [ ] Estimated completion date displays correctly
- [ ] Switch status updates properly
- [ ] Earnings received can be updated manually

### Direct Debit Requirements in Switch
- [ ] Required DD count displays correctly
- [ ] Traffic light indicators show correct status
- [ ] "Setup Direct Debits" button opens wizard
- [ ] "Add External DD" button opens external DD dialog
- [ ] DD progress updates when DDs are added
- [ ] Step auto-completes when all DDs are satisfied
- [ ] External DDs can be added and removed
- [ ] DD cards show linked switch information

## üí≥ STRIPE PAYMENT INTEGRATION
### Payment Method Setup
- [ ] Payment method setup form loads correctly
- [ ] Stripe Elements render properly
- [ ] Card input validation works
- [ ] Test card (4242 4242 4242 4242) is accepted
- [ ] Declined card (4000 0000 0000 0002) shows error
- [ ] Payment method is saved to Stripe customer
- [ ] Setup intent creation works
- [ ] Error handling works for failed payments
- [ ] Loading states display correctly

### Direct Debit Creation with Payment
- [ ] DD wizard includes payment step for SwitchPilot DDs
- [ ] Payment step is skipped for external/charity DDs
- [ ] Payment method collection works in wizard
- [ ] Stripe subscription creation works
- [ ] DD record is updated with Stripe IDs
- [ ] Subscription appears in Stripe dashboard
- [ ] Payment method is attached to customer
- [ ] Error handling works for subscription failures

### Payment History & Tracking
- [ ] Payment history displays in DD cards
- [ ] Payment amounts and dates show correctly
- [ ] Payment status indicators work
- [ ] Failed payments are tracked
- [ ] Successful payments update total collected
- [ ] Payment history loads without errors

### Webhook Processing
- [ ] Webhook endpoint accepts Stripe events
- [ ] Signature verification works
- [ ] Payment success events update DD status
- [ ] Payment failure events update DD status
- [ ] Subscription cancellation events work
- [ ] Invoice payment events are processed
- [ ] Database updates correctly from webhooks
- [ ] Error logging works for webhook failures

## üí∞ BILLING & DIRECT DEBIT MANAGEMENT
### Billing Page
- [ ] Billing page loads with all DDs
- [ ] DD cards display correctly with all information
- [ ] SwitchPilot DDs show payment method details
- [ ] External DDs show manual tracking info
- [ ] Filtering by status works (active, pending, cancelled, failed)
- [ ] Filtering by category works (switchpilot, charity, external)
- [ ] Sorting by amount, date, status works
- [ ] Summary statistics are accurate
- [ ] "Your Active DDs" count is correct
- [ ] "Your Monthly Total" calculation is correct
- [ ] "Your SwitchPilot DDs" count is correct
- [ ] "Your Total Collected" amount is correct

### Direct Debit Cards
- [ ] DD cards show provider information correctly
- [ ] Amount and frequency display properly
- [ ] Status badges show correct colors
- [ ] Next collection date displays
- [ ] Total collected amount shows
- [ ] Payment history section works for SwitchPilot DDs
- [ ] Linked switch information displays
- [ ] Cancel button works for active DDs
- [ ] Remove button works for external DDs
- [ ] Provider website links work
- [ ] Cards are responsive on mobile

### DD Setup Wizard
- [ ] Wizard opens and closes correctly
- [ ] Provider selection step works
- [ ] Amount selection step works
- [ ] Payment step appears for SwitchPilot DDs
- [ ] Payment step is skipped for external DDs
- [ ] Confirmation step shows correct summary
- [ ] Navigation between steps works
- [ ] Form validation works correctly
- [ ] Error messages display properly
- [ ] Success callback works
- [ ] Wizard resets properly after completion

### External DD Management
- [ ] External DD dialog opens correctly
- [ ] Form fields work (provider name, amount, frequency)
- [ ] External DDs are created with correct data
- [ ] External DDs display with "External" badge
- [ ] External DDs can be removed from tracking
- [ ] External DDs don't require payment method
- [ ] External DDs don't auto-cancel after switch

## üîß STRIPE INTEGRATION TESTING
### Stripe Dashboard Verification
- [ ] Customer is created in Stripe dashboard
- [ ] Payment method is attached to customer
- [ ] Subscription is created with correct amount
- [ ] Subscription billing cycle is monthly
- [ ] Subscription status is active
- [ ] Invoice is generated correctly
- [ ] Payment intent status is correct

### API Route Testing
- [ ] /api/stripe/create-setup-intent returns client_secret
- [ ] /api/stripe/create-subscription creates subscription
- [ ] /api/stripe/cancel-subscription cancels subscription
- [ ] /api/stripe/get-payment-method returns payment method
- [ ] /api/stripe/webhook processes events correctly
- [ ] All API routes require authentication
- [ ] Error responses are properly formatted

### Test Card Scenarios
- [ ] 4242 4242 4242 4242 (Visa) - Success
- [ ] 4000 0000 0000 0002 (Declined) - Failure
- [ ] 4000 0000 0000 9995 (Insufficient funds) - Failure
- [ ] 4000 0000 0000 0069 (Expired card) - Failure
- [ ] 4000 0000 0000 0119 (Processing error) - Failure

## üì± MOBILE RESPONSIVENESS
### Mobile Navigation
- [ ] Mobile sidebar opens and closes correctly
- [ ] Mobile sidebar is not transparent
- [ ] Navigation links work on mobile
- [ ] Mobile menu is accessible
- [ ] Touch interactions work properly

### Mobile Forms
- [ ] DD wizard is not too wide on mobile
- [ ] Payment method form fits mobile screen
- [ ] Form inputs are properly sized
- [ ] Buttons are touch-friendly
- [ ] No horizontal scrolling on mobile

### Mobile Cards & Layout
- [ ] All cards are responsive on mobile
- [ ] Text wraps properly in mobile view
- [ ] Images and icons scale correctly
- [ ] Tables are scrollable on mobile
- [ ] Modals fit mobile screen

## üé® UI/UX TESTING
### Visual Design
- [ ] All components use consistent styling
- [ ] Colors match design system
- [ ] Typography is consistent
- [ ] Spacing and padding are correct
- [ ] Icons display correctly
- [ ] Loading states are visually clear

### User Experience
- [ ] Navigation is intuitive
- [ ] Error messages are helpful
- [ ] Success messages are clear
- [ ] Loading states provide feedback
- [ ] Form validation is immediate
- [ ] Confirmation dialogs are clear

### Accessibility
- [ ] All interactive elements are keyboard accessible
- [ ] Screen reader compatibility
- [ ] Color contrast meets standards
- [ ] Focus indicators are visible
- [ ] Alt text for images
- [ ] Form labels are properly associated

## üöÄ PERFORMANCE & SECURITY
### Performance
- [ ] Page load times are acceptable
- [ ] Images are optimized
- [ ] API calls are efficient
- [ ] No memory leaks in components
- [ ] Database queries are optimized

### Security
- [ ] All API routes are authenticated
- [ ] User data is properly isolated
- [ ] Stripe webhook signature verification works
- [ ] No sensitive data in client-side code
- [ ] Environment variables are secure
- [ ] Database queries use proper parameters

## üß™ END-TO-END TESTING SCENARIOS
### Complete User Journey 1: SwitchPilot DD
1. [ ] User logs in
2. [ ] User views a bank deal with DD requirements
3. [ ] User starts a switch
4. [ ] User sets up SwitchPilot DD with payment
5. [ ] Payment method is collected successfully
6. [ ] Stripe subscription is created
7. [ ] DD appears in billing page as active
8. [ ] Payment history shows in DD card
9. [ ] User can cancel DD and subscription is cancelled

### Complete User Journey 2: External DD
1. [ ] User logs in
2. [ ] User starts a switch
3. [ ] User adds external DD manually
4. [ ] External DD appears in switch workflow
5. [ ] External DD appears in billing page
6. [ ] User can remove external DD from tracking
7. [ ] Switch progress updates correctly

### Complete User Journey 3: Mixed DDs
1. [ ] User sets up both SwitchPilot and external DDs
2. [ ] All DDs appear correctly in billing page
3. [ ] Traffic lights show correct status in switch
4. [ ] Switch completes when all DDs are satisfied
5. [ ] SwitchPilot DDs auto-cancel after switch completion

## üîß TECHNICAL TESTING
### Database Operations
- [ ] All CRUD operations work correctly
- [ ] Foreign key relationships are maintained
- [ ] RLS policies work correctly
- [ ] Data integrity is maintained
- [ ] Transactions work properly

### API Integration
- [ ] Supabase client works correctly
- [ ] Stripe API integration works
- [ ] Error handling is comprehensive
- [ ] Rate limiting is handled
- [ ] Timeout handling works

### Build & Deployment
- [ ] Application builds without errors
- [ ] TypeScript compilation succeeds
- [ ] ESLint warnings are handled
- [ ] Environment variables are configured
- [ ] Database migrations work
- [ ] Application deploys successfully

## üìä ANALYTICS & REPORTING
### Dashboard Analytics
- [ ] User statistics are accurate
- [ ] Switch progress calculations are correct
- [ ] Earnings calculations are accurate
- [ ] Revenue tracking works for SwitchPilot DDs
- [ ] Charts and graphs display correctly

### Admin Functions
- [ ] User management works
- [ ] Switch management works
- [ ] DD management works
- [ ] Payment tracking works
- [ ] Revenue reporting works

## üêõ ERROR HANDLING & EDGE CASES
### Network Errors
- [ ] API failures are handled gracefully
- [ ] Network timeouts are handled
- [ ] Offline scenarios are handled
- [ ] Retry mechanisms work

### Data Edge Cases
- [ ] Empty states are handled
- [ ] Invalid data is handled
- [ ] Missing data is handled
- [ ] Large datasets are handled

### User Edge Cases
- [ ] Multiple browser tabs work
- [ ] Session expiration is handled
- [ ] Concurrent operations work
- [ ] Race conditions are handled

## üìù DOCUMENTATION & MAINTENANCE
### Code Quality
- [ ] Code is well-documented
- [ ] Functions have proper types
- [ ] Error handling is comprehensive
- [ ] Code follows best practices
- [ ] No console errors in production

### Testing Coverage
- [ ] Critical paths are tested
- [ ] Edge cases are covered
- [ ] Error scenarios are tested
- [ ] User journeys are validated
- [ ] Performance is acceptable

---

## üéØ SESSION 9 SPECIFIC TESTS
### Stripe Integration
- [ ] Stripe CLI webhook testing works: `stripe listen --forward-to localhost:3000/api/stripe/webhook`
- [ ] Test cards work in payment forms
- [ ] Webhook events are received and processed
- [ ] Subscription creation works end-to-end
- [ ] Payment method setup works
- [ ] DD cancellation works with Stripe
- [ ] Payment history tracking works
- [ ] Revenue calculations are accurate

### Database Schema
- [ ] Stripe fields added to profiles table
- [ ] Stripe fields added to direct_debits table
- [ ] Payment history table created
- [ ] RLS policies work for new tables
- [ ] Foreign key relationships work

### UI Components
- [ ] PaymentMethodSetup component works
- [ ] PaymentMethodDisplay component works
- [ ] DD wizard payment step works
- [ ] Payment history displays in DD cards
- [ ] All Stripe-related UI is responsive

---

## ‚úÖ COMPLETION CHECKLIST
- [ ] All critical user journeys work
- [ ] All payment flows work with Stripe test mode
- [ ] All UI components are responsive
- [ ] All error scenarios are handled
- [ ] All database operations work correctly
- [ ] All API routes are secure and functional
- [ ] Application builds and deploys successfully
- [ ] No critical bugs remain
- [ ] Performance is acceptable
- [ ] Security requirements are met

---

**Testing Notes:**
- Use Stripe test mode for all payment testing
- Test with multiple user accounts
- Test on different devices and browsers
- Verify all database operations
- Check all error scenarios
- Validate all user journeys
- Ensure mobile responsiveness
- Verify security measures
- Test performance under load
- Validate all integrations

**Last Updated:** Session 9 - Stripe Payment Integration
**Next Review:** After Session 10
